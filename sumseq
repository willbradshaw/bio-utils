#!/bin/env bash
set -e
helpstr="SUMSEQ - print total length of all sequences in FASTA file
Usage: headgrep FILE

Options:
 -h: Print this help message and exit."

unset file
while [ $OPTIND -le $# ]; do
    while getopts "h" opt; do
        case "$opt" in
            h)
                echo "$helpstr"
                exit
                ;;
            *)
                echo "Invalid argument:" $opt >&2
                echo "$helpstr"
                exit
        esac
    done
    if [[ -z "$file" ]]; then
        file=${@:$OPTIND:1}
        OPTIND=$(expr $OPTIND + 1)
    fi
done
shift $((OPTIND-1))

# Argument errors and warnings:
if [[ -z $file ]]; then
    >&2 echo "Error: Input file required."
    echo "$helpstr"
    exit
fi

# Script:
headchar=$(awk '/./{print;exit}' $file | cut -c1)
if [[ "$headchar" == ">" ]]; then
    grep -v ">" $file | awk '{sum+=length($1)}END{print sum}'
else
    >&2 echo "Error: input file must be in FASTA format."
    exit 1
fi
exit
